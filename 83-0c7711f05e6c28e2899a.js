(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{794:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var a=n(8),r=function(e,t){return Object(a.b)({url:"/api/commment/get-comment/"+e,params:t})},o=function(e,t){return Object(a.b)({url:"/api/reply/get-reply/"+e,params:t})},i=function(e,t){return Object(a.c)({url:"/api/reply/create-reply/"+e,data:t})}},836:function(e,t,n){"use strict";n.r(t);n(61),n(114),n(28),n(11),n(53),n(32),n(18),n(83),n(24),n(13);var a=n(1),r=n.n(a),o=n(185),i=n.n(o),c=n(77),d=n(147),l=n(578),s=n.n(l),u=n(91),m=n(40),p=n(54),f=n(25),b=n(23),g=n(794),E=n(9),y=n(42),S=n(573),v=n(125),C=n(575);function _(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var I=function(e){var t,n;function a(t){var n;(n=e.call(this,t)||this).unmount=!1,n._setState=function(e,t){n.unmount||n.setState((function(t){return Object.assign({},t,{},e)}),t)},n.onSort=function(e,t){n.setState({sortBy:e,orderBy:t},(function(){n.getListReply()}))},n.getListReply=function(){if(!n.unmount){var e=n.state.commentId,t=n.props,a=t.pageSize,r=t.pageIndex,o=t.orderBy,i=t.sortBy;if(null!=e){var c={orderBy:o,pageNum:r,pageSize:a,sortBy:i};Object(f.b)(),Object(g.c)(e,c).promise.then((function(e){if(e.data&&e.data.code&&200===e.data.code&&e.data.value){var t=e.data.value&&e.data.value.list||[];n._setState({listReply:t,editItem:{}})}Object(f.a)()})).catch((function(){Object(f.a)()}))}}},n.formatTime=function(e){return e?Object(d.default)(new Date(e),E.g):""},n.onChangeContent=function(){return function(e){var t,a=n.state.editItem,r=s()(a,((t={})[e.target.name]={$set:e.target.value},t));n._setState({editItem:r})}},n.generateContent=function(e,t,a,o){var i=t.id===o.id?E.k.EDIT:E.k.VIEW,c=t.id===o.id?o.content:e;return r.a.createElement(v.a,{mode:i,type:"textarea",value:c,name:"content",onChange:n.onChangeContent(t,a)})},n.generateColumnUser=function(e){return n.props.user.id===e.id?r.a.createElement("b",null,e.name+" (Admin)"):e.name+" ("+e.username+")"},n.generateColumnId=function(e,t){return t.mode&&t.mode===E.k.NEW?"":e},n.onSave=function(){var e=n.state,t=e.editItem,a=e.commentId,r=n.props,o=r.requestData,i=r.receiveData;if(t&&t.mode){var c={content:t.content,id:t.id};t.mode===E.k.NEW&&delete c.id,o(),Object(g.a)(a,c).promise.then((function(e){if(i(),!e||!e.data||200!==e.data.code)throw new Error("err");n.getListReply(),n.turnAlert()})).catch((function(e){i(),n.turnAlert(!1,e.response&&e.response.data&&e.response.data.message)}))}},n.turnAlert=function(e,t){void 0===e&&(e=!0);var a=n.props.toggleAlert;a(e?{color:E.b.SUCCESS,text:"IDS_ALERT_UPDATE_SUCCESS",message:t}:{color:E.b.DANGER,text:"IDS_ALERT_UPDATE_FAIL",message:t})},n.onCancelSave=function(){var e=n.state.listReply.filter((function(e){return!e.mode||e.mode!==E.k.NEW}));n._setState({editItem:{},listReply:e})},n.generateColumns=function(){var e=n.props.intl.formatMessage,t=n.state.editItem,a=Object.assign({},t);return[{dataField:"id",text:"ID",sort:!0,headerStyle:{width:"80px"},formatter:n.generateColumnId},{dataField:"createdBy",text:e({id:"IDS_LABEL_COMMENT_USER_REPLY"}),formatter:n.generateColumnUser,sort:!0},{dataField:"content",text:e({id:"IDS_LABEL_COMMENT_CONTENT"}),sort:!0,formatter:n.generateContent,formatExtraData:a},{dataField:"createdDate",text:e({id:"IDS_LABEL_COMMENT_CREATE_DATE"}),sort:!0,headerStyle:{width:"180px"},formatter:function(e,t){return n.formatTime(t.createdDate)}},{dataField:"tool",text:e({id:"IDS_DISH_LABEL_TOOLS"}),formatExtraData:a,formatter:n.generateTools,headerStyle:{width:"110px"},style:{textAlign:"center"}}]},n.generateTools=function(e,t,a,o){var i=n.props.user,c=t.createdBy;return o.id===t.id?r.a.createElement("div",{className:"tool d-flex flex-column"},r.a.createElement("button",{type:"button",className:"btn btn-primary my-2 mx-2 d-block rounded btn-sm btn-md",onClick:n.onSave},r.a.createElement(y.a,{Tag:"<>",id:"IDS_SAVE_BTN"})),r.a.createElement("button",{type:"button",className:"btn btn-secondary my-2 mx-2 d-block rounded btn-sm btn-md",onClick:n.onCancelSave},r.a.createElement(y.a,{Tag:"<>",id:"IDS_CANCEL_BTN"}))):r.a.createElement("div",{className:"tool"},i.id===c.id&&r.a.createElement("button",{type:"button",disabled:o.id,className:"btn btn-info my-2 mx-2 rounded btn-sm btn-md",onClick:n.handleClickEdit(t,a)},r.a.createElement(m.p,null)))},n.handleClickEdit=function(e){return function(t){t&&(t.preventDefault(),t.stopPropagation());var a=Object.assign({},e,{mode:E.k.EDIT});n.setState({editItem:a})}},n.onClickAdd=function(){var e=n.props.user,t={content:"",mode:E.k.NEW,id:(new Date).getTime(),createdBy:e,createdDate:new Date},a=n.state.listReply,r=[t].concat(_(a));n._setState({editItem:t,listReply:r})};var a=i.a.parse(t.location.search);return a&&a.id||Object(u.navigate)(b.a.COMMENT),n.state={commentId:a.id,listReply:[],totalSize:0,editItem:{}},n}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var o=a.prototype;return o.componentDidMount=function(){this.getListReply()},o.componentWillUnmount=function(){this.unmount=!0},o.render=function(){var e=this.state,t=e.listReply,n=e.totalSize,a=e.editItem,o=this.props,i=o.pageSize,c=o.onSort,d=o.onPageChange,l=o.onSizePerPageChange;return r.a.createElement("div",{className:"page-wrapper reply-wrapper container-fluid"},r.a.createElement("div",{className:"d-sm-flex align-items-center header-wrapper"},r.a.createElement(y.a,{id:"IDS_LABEL_LIST_REPLY",Tag:"h3",className:"mb-0 text-dark"})),r.a.createElement("div",{className:"reply-body-wrapper"},r.a.createElement("div",{className:"col text-right pr-0 mb-2"},r.a.createElement("button",{disabled:a.id,className:"btn btn-success rounded",type:"button",onClick:this.onClickAdd},r.a.createElement(y.a,{Tag:"<>",id:"IDS_LABEL_COMMENT_ADD_REPLY"}))),r.a.createElement("div",{className:"table-wrapper"},r.a.createElement(S.a,{totalSize:n,keyField:"id",data:t,columns:this.generateColumns(),onPageChange:d,onSizePerPageChange:l,pageSize:i,onSort:c}))))},a}(a.PureComponent),h={pageSize:E.h,pageIndex:1,orderBy:"desc",sortBy:"createdDate",functionGetData:"getListReply"};t.default=Object(c.injectIntl)(Object(p.b)((function(e){return{restaurantId:e.restaurant.restaurantId,user:e.user.info}}),(function(e){return{requestData:function(){return e(Object(f.b)())},receiveData:function(){return e(Object(f.a)())},toggleAlert:function(t){return e(Object(f.c)(t))}}}))(Object(C.a)(I,h)))}}]);