(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{793:function(e,t,a){"use strict";var n=a(1),r=a.n(n),l=a(649),c=a(639),s=a(641),o=a(325),i=a(42),m=r.a.memo((function(e){var t=e.isOpen,a=e.toggle,n=e.onOk,m=e.centered;return r.a.createElement(l.a,{size:"sm",isOpen:t,toggle:a,centered:m},r.a.createElement(c.a,null,r.a.createElement(i.a,{id:"IDS_CONFIRM_DELETE"})),r.a.createElement(s.a,null,r.a.createElement(o.a,{className:"btn-danger",onClick:n},r.a.createElement(i.a,{Tag:"<>",id:"IDS_CONFIRM_OK"})),r.a.createElement(o.a,{onClick:a},r.a.createElement(i.a,{Tag:"<>",id:"IDS_CONFIRM_NO"}))))}));m.defaultProps={isOpen:!1,toggle:function(e){return e},onOk:function(e){return e},centered:!0},t.a=m},843:function(e,t,a){"use strict";a.r(t);a(22),a(83),a(18),a(19),a(11),a(13);var n=a(1),r=a.n(n),l=a(54),c=a(115),s=a.n(c),o=a(77),i=a(91),m=a(185),d=a.n(m),E=a(40),u=a(9),_=a(25),g=a(42),O=a(587),b=a(23),D=(a(24),a(637)),p=a(645),I=a(646),L=a(638),N=a(78);function f(e){var t=e.user,a=e.tableLocation,l=Object(n.useState)(!0),c=l[0],s=l[1];return r.a.createElement(D.a,{className:"user-order-card shadow mt-4"},r.a.createElement(p.a,{onClick:function(){return s(!c)},className:"cursor-pointer"},r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_INFO_USER",Tag:"<>"})),r.a.createElement(I.a,{isOpen:c},r.a.createElement(L.a,null,t&&r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a,{id:"username",label:"IDS_LABEL_ORDER_INFO_USERNAME",value:t&&t.username,name:"username",mode:u.k.VIEW,isReadOnly:!0,type:"text",classLabel:"col-md-4 col-lg-3 border-right",classInputContainer:"col-md-8 col-lg-9",classWrapper:"border border-bottom-0 m-0"}),r.a.createElement(N.a,{id:"name",label:"IDS_LABEL_ORDER_INFO_USER_NAME",value:t&&t.name,name:"name",mode:u.k.VIEW,isReadOnly:!0,type:"text",classLabel:"col-md-4 col-lg-3 border-right",classInputContainer:"col-md-8 col-lg-9",classWrapper:"border border-bottom-0 m-0"}),r.a.createElement(N.a,{id:"email",label:"IDS_LABEL_EMAIL",value:t&&t.email,name:"email",mode:u.k.VIEW,isReadOnly:!0,type:"text",classLabel:"col-md-4 col-lg-3 border-right",classInputContainer:"col-md-8 col-lg-9",classWrapper:"border border-bottom-0 m-0"}),r.a.createElement(N.a,{id:"phoneNumber",label:"IDS_LABEL_ORDER_INFO_USER_PHONENUMBER",value:t&&t.phoneNumber,name:"phoneNumber",mode:u.k.VIEW,isReadOnly:!0,type:"text",classLabel:"col-md-4 col-lg-3 border-right",classInputContainer:"col-md-8 col-lg-9",classWrapper:"border border-bottom-0 m-0"}),r.a.createElement(N.a,{id:"tableLocation",label:"IDS_LABEL_ORDER_INFO_USER_TABLE_LOCATION",value:a,name:"tableLocation",mode:u.k.VIEW,isReadOnly:!0,type:"text",classLabel:"col-md-4 col-lg-3 border-right",classInputContainer:"col-md-8 col-lg-9",classWrapper:"border m-0"})))))}var S=a(67),h=a(576),R=a(964);a(615);function v(e){var t=e.orderItems,a=e.afterCommonDiscount,n=e.afterVAT,l=e.beforeCommonDiscount,c=e.commonDiscount,s=e.commonDiscountCode;return r.a.createElement(R.a,{responsive:!0,bordered:!0,className:"order-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement(g.a,{className:"column-stt",Tag:"th",id:"IDS_LABEL_ORDER_INFO_BILL_STT"}),r.a.createElement(g.a,{className:"column-content",Tag:"th",id:"IDS_LABEL_ORDER_INFO_BILL_CONTENT"}),r.a.createElement(g.a,{className:"column-quantity text-right",Tag:"th",id:"IDS_LABEL_ORDER_INFO_BILL_QUANTITY"}),r.a.createElement(g.a,{className:"column-price text-right",Tag:"th",id:"IDS_LABEL_ORDER_INFO_BILL_PRICE"}),r.a.createElement(g.a,{className:"column-discount text-right",Tag:"th",id:"IDS_LABEL_ORDER_INFO_BILL_DISCOUNT"}),r.a.createElement(g.a,{className:"column-total-price text-right",Tag:"th",id:"IDS_LABEL_ORDER_INFO_BILL_TOTAL_PRICE"}))),r.a.createElement("tbody",null,t.map((function(e,t){return r.a.createElement("tr",{key:e.id+"-"+t},r.a.createElement("th",{scope:"row"},t+1),r.a.createElement("td",null,e.name+" "+(e.dishSize?"("+e.dishSize+")":"")),r.a.createElement("td",{className:"text-right"},Object(S.n)(e.quantity)),r.a.createElement("td",{className:"text-right"},Object(S.n)(e.beforeDiscountPrice/e.quantity)),r.a.createElement("td",{className:"text-right"},(e.discountValue||0)+" %"),r.a.createElement("td",{className:"text-right"},Object(S.n)(e.afterDiscountPrice)))})),r.a.createElement("tr",null,r.a.createElement("td",{colSpan:"6",className:"border-bottom-style-dotted"},r.a.createElement("div",{className:"d-flex justify-content-between"},r.a.createElement(g.a,{className:"font-weight-bolder",Tag:"label",id:"IDS_LABEL_ORDER_INFO_BILL_TOTAL_ALL_PRICE_WITHOUT_ALL"}),r.a.createElement(g.a,{values:{number:Object(S.n)(l)},id:"IDS_LABEL_PLACEHOLDER_MONEY"})),r.a.createElement("div",{className:"d-flex justify-content-between"},r.a.createElement(g.a,{values:{commonDiscount:s},className:"font-weight-bolder",Tag:"label",id:"IDS_LABEL_ORDER_INFO_BILL_COMMON_DISCOUNT"}),r.a.createElement("span",null,"-"+c+"%")),r.a.createElement("div",{className:"d-flex justify-content-between"},r.a.createElement(g.a,{className:"font-weight-bolder",Tag:"label",id:"IDS_LABEL_ORDER_INFO_BILL_TOTAL_ALL_PRICE_WITHOUT_VAT"}),r.a.createElement(g.a,{values:{number:Object(S.n)(a)},id:"IDS_LABEL_PLACEHOLDER_MONEY"})),r.a.createElement("div",{className:"d-flex justify-content-between"},r.a.createElement(g.a,{className:"font-weight-bolder",Tag:"label",id:"IDS_LABEL_ORDER_INFO_BILL_VAT"}),r.a.createElement(g.a,{values:{number:Object(S.n)(a/10)},id:"IDS_LABEL_PLACEHOLDER_MONEY"})))),r.a.createElement("tr",null,r.a.createElement("td",{colSpan:"6",className:"border-top-0"},r.a.createElement("div",{className:"d-flex justify-content-between"},r.a.createElement(g.a,{className:"font-weight-bolder",Tag:"label",id:"IDS_LABEL_ORDER_INFO_BILL_TOTAL_PRICE_AND_VAT"}),r.a.createElement(g.a,{values:{number:Object(S.n)(n)},id:"IDS_LABEL_PLACEHOLDER_MONEY"}))))))}v.defaultProps={orderItems:[],totalPrice:0};var A=Object(o.injectIntl)(v),T=function(e,t){return null!=e&&null!==h.c.items[e]&&void 0!==h.c.items[e]?t({id:h.c.items[e]}):e};function B(e){var t=e.createdDate,a=e.lastModifiedDate,l=e.note,c=e.orderStatus,s=e.formatMessage,o=Object(n.useState)(!0),i=o[0],m=o[1];return r.a.createElement(D.a,{className:"info-order-card shadow mt-4"},r.a.createElement(p.a,{onClick:function(){return m(!i)},className:"cursor-pointer"},r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_INFO_ORDER",Tag:"<>"})),r.a.createElement(I.a,{isOpen:i},r.a.createElement(L.a,null,r.a.createElement(N.a,{id:"createdDate",label:"IDS_LABEL_ORDER_INFO_ORDER_CREATED_TIME",value:Object(S.i)(1e3*t,u.g),name:"createdDate",mode:u.k.VIEW,isReadOnly:!0,type:"text",classLabel:"col-md-4 col-lg-3 border-right",classInputContainer:"col-md-8 col-lg-9",classWrapper:"border border-bottom-0 m-0"}),r.a.createElement(N.a,{id:"lastModifiedDate",label:"IDS_LABEL_ORDER_INFO_ORDER_MODIFIER_TIME",value:Object(S.i)(1e3*a,u.g),name:"lastModifiedDate",mode:u.k.VIEW,isReadOnly:!0,type:"text",classLabel:"col-md-4 col-lg-3 border-right",classInputContainer:"col-md-8 col-lg-9",classWrapper:"border border-bottom-0 m-0"}),r.a.createElement(N.a,{id:"note",label:"IDS_LABEL_ORDER_INFO_ORDER_NOTE",value:l,name:"note",mode:u.k.VIEW,isReadOnly:!0,type:"text",classLabel:"col-md-4 col-lg-3 border-right",classInputContainer:"col-md-8 col-lg-9",classWrapper:"border border-bottom-0 m-0"}),r.a.createElement(N.a,{id:"orderStatus",label:"IDS_DISH_LABEL_STATUS",value:T(c,s),name:"orderStatus",mode:u.k.VIEW,isReadOnly:!0,type:"text",classLabel:"col-md-4 col-lg-3 border-right",classInputContainer:"col-md-8 col-lg-9",classWrapper:"border m-0"}),r.a.createElement("br",null),r.a.createElement("div",{className:"order-table-wrapper"},r.a.createElement(A,e)))))}var C=a(793),w=a(240),y=(a(616),a(649)),M=a(639),x=a(640),F=a(641),j=a(958),k=a.n(j),P=(a(617),r.a.forwardRef((function(e,t){var a=e.orderDetail,n=e.restaurant,l=new Date;return r.a.createElement("div",{ref:t,className:"invoice-wrapper"},r.a.createElement("div",{className:"restaurant-info"},r.a.createElement("h1",{className:"text-center font-weight-bolder"},n&&n.name||"Nhà hàng Nhật Bản"),r.a.createElement("h6",{className:"text-center font-weight-bolder mt-3"},r.a.createElement(g.a,{id:"IDS_LABEL_ADDRESS",Tag:"<>"}),": ",n&&n.address||"36 hoàn kiếm")),r.a.createElement("div",{className:"user-order-info"},r.a.createElement("div",{className:"row form-group"},r.a.createElement("div",{className:"col-6 d-flex"},r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_INFO_USER_NAME",className:"font-weight-bolder"}),": ",r.a.createElement("span",{className:"flex-grow-1 border-dashed pl-2"},a&&a.user&&a.user.name)),r.a.createElement("div",{className:"col-6 d-flex"},r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_INFO_ORDER_NUMBER_ORDER",className:"font-weight-bolder"}),": ",r.a.createElement("span",{className:"flex-grow-1 border-dashed pl-2"},a&&a.orderId))),r.a.createElement("div",{className:"row form-group"},r.a.createElement("div",{className:"col-6 d-flex"},r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_INFO_USER_PHONENUMBER",className:"font-weight-bolder"}),": ",r.a.createElement("span",{className:"flex-grow-1 border-dashed pl-2"},a&&a.user&&a.user.phoneNumber)),r.a.createElement("div",{className:"col-6 d-flex"},r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_INFO_BILL_TIME_IN",className:"font-weight-bolder"}),": ",r.a.createElement("span",{className:"flex-grow-1 border-dashed pl-2"},a&&a.createdDate&&Object(S.i)(1e3*a.createdDate,u.f)))),r.a.createElement("div",{className:"row form-group"},r.a.createElement("div",{className:"col-6 d-flex"},r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_INFO_USER_TABLE_LOCATION",className:"font-weight-bolder"}),": ",r.a.createElement("span",{className:"flex-grow-1 border-dashed pl-2"},a&&a.tableLocation)),r.a.createElement("div",{className:"col-6 d-flex"},r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_INFO_BILL_TIME_OUT",className:"font-weight-bolder"}),": ",r.a.createElement("span",{className:"flex-grow-1 border-dashed pl-2"},Object(S.i)(l.getTime(),u.f))))),r.a.createElement(g.a,{className:"text-center mt-4 mb-2",Tag:"h4",id:"IDS_LABEL_INVOICE_TITLE"}),r.a.createElement(A,a),r.a.createElement("div",{className:"sign-wrapper row form-group"},r.a.createElement("div",{className:"col-6 d-flex flex-column text-center mt-3"},r.a.createElement("span",null," "),r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_INFO_SIGN_BUYER",className:"font-weight-bolder font-italic"}),r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_INFO_SIGN_AND_WRITE_NAME",Tag:"small",className:"font-italic"})),r.a.createElement("div",{className:"col-6 d-flex flex-column text-center mt-3"},r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_INFO_SIGN_DATE",values:{date:l.getDate(),month:l.getMonth()+1,year:l.getFullYear()}}),r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_INFO_SIGN_SELLER",className:"font-weight-bolder font-italic"}),r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_INFO_SIGN_AND_WRITE_NAME",Tag:"small",className:"font-italic"}))))}))),U=function(e){var t=e.isOpen,a=e.toggle,l=e.orderDetail,c=e.restaurant,s=Object(n.useRef)();return r.a.createElement(y.a,{size:"xl",isOpen:t,toggle:a,centered:!0},r.a.createElement(M.a,{toggle:a,gag:"h4"},r.a.createElement(g.a,{Tag:"<>",id:"IDS_LABEL_INVOICE_TITLE"})),r.a.createElement(x.a,{className:"p-0"},r.a.createElement(P,{ref:s,restaurant:c,orderDetail:l})),r.a.createElement(F.a,null,r.a.createElement(k.a,{trigger:function(){return r.a.createElement("button",{className:"btn btn-primary",type:"button"},r.a.createElement(g.a,{Tag:"<>",id:"IDS_LABEL_INVOICE_BTN_PRINT"}))},content:function(){return s.current},bodyClass:"invoice-body"}),r.a.createElement("button",{className:"btn btn-secondary",onClick:a,type:"button"},r.a.createElement(g.a,{Tag:"<>",id:"IDS_CONFIRM_NO"}))))};U.defaultProps={orderDetail:{},isOpen:!1,toggle:function(e){return e},onOk:function(e){return e}};var W=U;var V=function(e){var t,a;function n(t){var a;(a=e.call(this,t)||this).unmount=!1,a._setState=function(e,t){a.unmount||a.setState((function(t){return Object.assign({},t,{},e)}),t)},a.scheduleGetData=function(){clearInterval(a.interval),a.interval=setInterval((function(){a.getBillDetail()}),6e4)},a.cancelScheduleGetData=function(){clearInterval(a.interval)},a.getBillDetail=function(){if(!a.unmount){var e=a.state.orderId,t=a.props,n=t.requestData,r=t.receiveData;e&&(n(),Object(O.c)(e).promise.then((function(e){e&&e.data&&200===e.data.code&&e.data.value?a._setState({orderDetail:e.data.value}):a._setState({orderDetail:{}}),r()})).catch((function(){r()})))}},a.resetData=function(){a._setState({orderDetail:{}})},a.navigateToListOrder=function(){Object(i.navigate)(b.a.ORDER)},a.toggleDeleteModal=function(e){return function(){var t={isOpenDeleteModal:!a.state.isOpenDeleteModal};a._setState(t,e)}},a.onOkDeleteModal=function(){var e=a.state.orderDetail,t=a.props,n=t.requestData,r=t.receiveData;e.id&&(n(),Object(O.b)(e.orderId).promise.then((function(){r(),a.turnAlert(),a.toggleDeleteModal((function(){a.navigateToListOrder()}))()})).catch((function(e){a.toggleDeleteModal(),a.turnAlert(!1,e&&e.response&&e.response.data&&e.response.data.message||""),r()})))},a.turnAlert=function(e,t){void 0===e&&(e=!0);var n=a.props.toggleAlert;n(e?{color:u.b.SUCCESS,text:"IDS_ALERT_UPDATE_SUCCESS",message:t}:{color:u.b.DANGER,text:"IDS_ALERT_UPDATE_FAIL",message:t})},a.changeStatusOrder=function(){var e=a.state,t=e.orderDetail,n=e.tmpStatus,r=a.props,l=r.requestData,c=r.receiveData;l(),Object(O.a)(t.orderId,n).promise.then((function(e){if(!e||!e.data||200!==e.data.code)throw new Error("Error");a.turnAlert(),a.getBillDetail(),a.toggleChangeStatus()(),c()})).catch((function(){a.turnAlert(0),c()}))},a.toggleChangeStatus=function(e){return function(){var t={isOpenChangeStatus:!a.state.isOpenChangeStatus};a._setState(t,e)}},a.onChangeStatus=function(e){a._setState({tmpStatus:e.target.value})},a.getListStatus=s()((function(e){var t=a.props.intl.formatMessage,n=e.keys,r={};return n.forEach((function(a){var n;r=Object.assign({},r,((n={})[a]={text:t({id:e.items[a]})},n))})),{keys:n,items:r}})),a.getLabelOrderStatus=function(e){var t=a.props.intl.formatMessage;return null!=e&&null!==h.b.items[e]&&void 0!==h.b.items[e]?t({id:h.b.items[e]}):e},a.generateChangeOrderView=function(e,t){return e?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{className:"font-weight-bolder"},a.getLabelOrderStatus(t)),r.a.createElement("span",{className:"ml-3 mr-3"},"->"),r.a.createElement(w.a,{list:a.getListStatus(h.b),mode:u.k.EDIT,name:"orderStatus",value:t,onChange:a.onChangeStatus,classInput:"mr-3"}),r.a.createElement("button",{className:"btn btn-primary mr-3",type:"button",onClick:a.changeStatusOrder},r.a.createElement(g.a,{Tag:"<>",id:"IDS_EDIT_BTN"})),r.a.createElement("button",{className:"btn btn-secondary",type:"button",onClick:a.toggleChangeStatus()},r.a.createElement(g.a,{Tag:"<>",id:"IDS_CANCEL_BTN"}))):r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"btn btn-primary mr-3",type:"button",onClick:a.toggleChangeStatus()},r.a.createElement(g.a,{Tag:"<>",id:"IDS_LABEL_BTN_CHANGE_ORDER_STATUS"})),r.a.createElement("button",{className:"btn btn-danger mr-3",type:"button",onClick:a.toggleDeleteModal()},r.a.createElement(g.a,{Tag:"<>",id:"IDS_LABEL_BTN_DELETE_ORDER"})),r.a.createElement("button",{className:"btn btn-success",type:"button",onClick:a.toggleOpenPrintModal},r.a.createElement(g.a,{Tag:"<>",id:"IDS_LABEL_CREATE_BILL"})))},a.toggleOpenPrintModal=function(){var e={isOpenPrintModal:!a.state.isOpenPrintModal};a._setState(e)};var n=t&&t.location&&t.location.state&&t.location.state.mode||u.k.VIEW,l=d.a.parse(t.location.search);return l&&l.id||Object(i.navigate)(b.a.ORDER),a.state={orderDetail:{},isOpenDeleteModal:!1,isOpenChangeStatus:!1,mode:n,orderId:l.id,tmpStatus:-1,isOpenPrintModal:!1},a}a=e,(t=n).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a;var l=n.prototype;return l.componentDidMount=function(){this.props.mode!==u.k.NONE?(this.getBillDetail(),this.scheduleGetData()):this.interval&&this.cancelScheduleGetData()},l.componentDidUpdate=function(e,t){this.state.isOpenChangeStatus!==t.isOpenChangeStatus&&this.state.isOpenChangeStatus&&Object.keys(this.state.orderDetail).length&&this._setState({tmpStatus:this.state.orderDetail.orderStatus}),this.state.isOpenChangeStatus!==t.isOpenChangeStatus&&(this.state.isOpenChangeStatus?this.cancelScheduleGetData():this.scheduleGetData())},l.componentWillUnmount=function(){this.unmount=!0,this.cancelScheduleGetData()},l.render=function(){var e=this.state,t=e.orderDetail,a=e.isOpenDeleteModal,n=e.isOpenPrintModal,l=e.orderId,c=e.isOpenChangeStatus,s=e.tmpStatus,o=this.props,i=o.intl,m=o.restaurant;return r.a.createElement("div",{className:"page-wrapper bill-detail-wrapper container-fluid"},r.a.createElement("div",{className:"d-sm-flex align-items-center header-wrapper"},r.a.createElement("h4",{onClick:this.navigateToListOrder,className:"mr-2 mb-1 cursor-pointer text-secondary"},r.a.createElement(E.b,null)),r.a.createElement(g.a,{id:"IDS_LABEL_ORDER_WITH_ID",values:{orderId:l},Tag:"h4",className:"mb-0 text-dark"})),r.a.createElement("div",{className:"bill-detail-body-wrapper"},r.a.createElement("div",{className:"toolbar-bill-wrapper d-flex justify-content-end align-items-center"},this.generateChangeOrderView(c,s)),r.a.createElement(f,{user:t&&t.user,tableLocation:t&&t.tableLocation}),r.a.createElement(B,Object.assign({},t,{formatMessage:i.formatMessage})),r.a.createElement(C.a,{isOpen:a,toggle:this.toggleDeleteModal(),onOk:this.onOkDeleteModal}),r.a.createElement(W,{isOpen:n,orderDetail:t,toggle:this.toggleOpenPrintModal,restaurant:m.info||{}})))},n}(r.a.PureComponent);t.default=Object(l.b)((function(e){return{restaurantId:e.restaurant.restaurantId,restaurant:e.restaurant}}),(function(e){return{requestData:function(){return e(Object(_.b)())},receiveData:function(){return e(Object(_.a)())},toggleAlert:function(t){return e(Object(_.c)(t))}}}))(Object(o.injectIntl)(V))}}]);